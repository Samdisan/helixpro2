<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HELIX | GLOBAL ARCHIVES</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .main-content { max-width: 800px; margin: 0 auto; padding: 20px; }
        
        /* TABS / FILTERS */
        .filter-bar { display: flex; gap: 10px; margin-bottom: 30px; overflow-x: auto; padding-bottom: 10px; }
        .filter-btn { 
            background: #111; border: 1px solid #333; color: #666; 
            padding: 8px 16px; cursor: pointer; text-transform: uppercase; 
            font-family: var(--font-term); font-size: 0.8rem; transition: 0.3s; white-space: nowrap; 
        }
        .filter-btn:hover { border-color: #fff; color: #fff; }
        .filter-btn.active { background: var(--accent-cyan); color: #000; border-color: var(--accent-cyan); font-weight: bold; }

        /* CARDS */
        .lore-card { background: rgba(10, 10, 10, 0.9); border: 1px solid #333; padding: 25px; margin-bottom: 20px; animation: fadeIn 0.5s ease; }
        .card-meta { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.7rem; color: #888; border-bottom: 1px dashed #333; padding-bottom: 5px; }
        
        .access-lvl { font-weight: bold; color: #000; padding: 2px 6px; }
        .lvl-YELLOW { background: var(--accent-gold); }
        .lvl-RED { background: var(--accent-red); }
        .lvl-BLACK { background: #000; color: var(--accent-red); border: 1px solid var(--accent-red); }
        
        .card-title { font-size: 1.5rem; color: #fff; margin: 0 0 10px 0; text-transform: uppercase; }
        .card-text { font-size: 0.9rem; color: #bbb; line-height: 1.6; }
        .card-text p { margin: 0 0 0.75em 0; }
        .card-text p:last-child { margin-bottom: 0; }
        .card-text .protocol-header { margin-bottom: 1em; font-size: 0.85rem; color: #888; }
        .card-text .protocol-section { margin-top: 1.25em; }
        .card-text .protocol-section-title { margin-bottom: 0.35em; color: var(--accent-gold, #c9a227); }
        
        .hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <nav class="nav-bar">
        <div class="nav-brand">GLOBAL ARCHIVES</div>
        <div class="nav-links">
            <a href="index.html">ROOT</a>
        </div>
    </nav>

    <div class="main-content">
        <div style="text-align: right; font-size: 10px; color: #555; margin-bottom: 20px;">
            DATABASE: ROOT SECTION
        </div>

        <div class="filter-bar">
            <button class="filter-btn active" onclick="filterLore('ALL', this)">ALL FILES</button>
            <button class="filter-btn" onclick="filterLore('CORP', this)">CORPORATION</button>
            <button class="filter-btn" onclick="filterLore('BIO', this)">BIO-HAZARD</button>
            <button class="filter-btn" onclick="filterLore('HIST', this)">HISTORY</button>
            <button class="filter-btn" onclick="filterLore('ORIGIN', this)">ORIGIN</button>
        </div>

        <div id="loader" style="text-align:center; color: var(--accent-cyan);">ЗАВАНТАЖЕННЯ ДАНИХ...</div>
        <div id="lore-container"></div>
    </div>

    <script src="system.js"></script>
    <script>
        const JSON_URL = 'helix_data.json'; 
        const TARGET_SECTION = 'root'; 

        document.addEventListener('DOMContentLoaded', () => {
            fetch(JSON_URL + '?t=' + Date.now())
                .then(res => res.json())
                .then(data => {
                    const filtered = data.filter(item => (item.section || 'root') === TARGET_SECTION);
                    render(filtered);
                })
                .catch(err => {
                    document.getElementById('loader').innerText = "ПОМИЛКА: НЕМАЄ ДАНИХ";
                    document.getElementById('loader').style.color = "red";
                });
        });

        function esc(s) {
            if (s == null) return '';
            const d = document.createElement('div');
            d.textContent = s;
            return d.innerHTML;
        }
        function render(data) {
            const container = document.getElementById('lore-container');
            document.getElementById('loader').style.display = 'none';
            
            if(data.length === 0) {
                container.innerHTML = "<div style='text-align:center; color:#555;'>АРХІВ ПОРОЖНІЙ</div>";
                return;
            }

            container.innerHTML = data.map(item => {
                var safeTitle = esc(item.title);
                var safeCategory = esc(item.category);
                var safeDisplayId = esc(item.display_id);
                var safeLevel = esc(item.level);
                return `
                <div class="lore-card" data-category="${safeCategory}">
                    <div class="card-meta">
                        <span>ID: ${safeDisplayId}</span>
                        <span class="access-lvl lvl-${safeLevel}">${safeLevel}</span>
                    </div>
                    <h2 class="card-title">${safeTitle}</h2>
                    <div class="card-text">${item.text}</div>
                </div>
            `;
            }).join('');
        }

        function filterLore(cat, eventElement) {
            // Зміна активної кнопки
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            const target = eventElement || event?.target;
            if (target) target.classList.add('active');

            // Фільтрація карток
            const cards = document.querySelectorAll('.lore-card');
            cards.forEach(card => {
                if (cat === 'ALL' || card.getAttribute('data-category') === cat) {
                    card.classList.remove('hidden');
                    card.style.animation = 'none';
                    card.offsetHeight; /* trigger reflow */
                    card.style.animation = 'fadeIn 0.5s ease';
                } else {
                    card.classList.add('hidden');
                }
            });
        }
    </script>
</body>
</html>